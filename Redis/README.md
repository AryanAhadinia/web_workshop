<p align="center">
    <img src="https://github.com/AryanAhadinia/web_workshop/blob/redis/Redis/public/redis_logo.svg" alt="Redis Logo">
</p>

<p align="center">
    تحقیق پایانی برنامه سازی وب، دانشگاه صنعتی شریف
    <br/>
    ارائه دهنده درس: جناب آقای امید جعفری نژاد
    <br/>
    نویسندگان: آرین احدی نیا
</p>

<div dir="rtl">

## ردیس چیست؟

ردیس یک انبار در حافظه داده ساختار (in-memory data structure store) است که میتواند به عنوان پایگاه داده یا حافظه نهان (cache) یا کارگزار پیام (message broker) استفاده شود.
ردیس داده ساختار هایی را از قبیل رشته (strings)، هش (hashes)، لیست (lists)، مجموعه (sets)، مجموعه مرتب (sorted sets)، بیتمپ (bitmaps)، جریان ها (streams) و ... ارائه میدهد.
ردیس، مجموعه ای از امکانات دخلی از قبیل تکرر (replication)، اسکیریپ نویسی لوآ (Lua scripting)، تخلیه LRU و ... را ارائه میدهد.

ردیس در خانواده پایگاه داده های کلید-مقدار (key-value) قرار میگیرد.
از آنجایی که ردیس رویه کلید-مقداری دارد. اغلب به عنوان یک داده ساختار معرفی میشود

## متن باز

خبر خوب اینکه ردیس یک پروژه متن باز است و شما می توانید به متن منبع این پروژه در GitHub دسترسی پیدا کنید.
[github.com/redis](https://github.com/redis)

## نصب ردیس

روش های مختلفی برای نصب ردیس وجود دارد. در این مقاله، ما به نصب ردیس در داکر، در لینوکس و در ویندوز اشاره می کنیم.

### نصب در داکر

استفاده از این روش، به دلیل سادگی و سهولت قویا توصیه میشود. با طی مراحل زیر، میتوانید ردیس را در داکر خود نصب کنید.

#### پیشنیاز ها
1. command line
2. یک عدد داکر صحیح و سالم و در وضعیت running
3. کاربر با دسترسی admin در سیستم عامل (sudo و root در لینوکس)

#### مراحل

1. با استفاده از دستور زیر، یک کانینر ردیس با نام دلخواه باز کنید. در صورت لزوم میتوانید نسخه نصب را نیز مشخص کنید. در دستور زیر چون نسخه نصب را مشخص نکرده ایم، سیستم به صورت خودکار آخرین نسخه (latest) را نصب خواهد کرد.

<div dir="ltr">

```
docker run --name my-first-redis -d redis
```
</div>

در تصویر پایین، تصویر ترمینال پس از اجرای موفقیت آمیز این دستور قرار دارد.

2. دستور زیر را در ترمینال اجرا کنید تا مطابق تصویر، از صحت نصب و اجرای ردیس اطلاع پیدا کنید.

<div dir="ltr">

```
docker ps
```
</div>

<img src="https://github.com/AryanAhadinia/web_workshop/blob/redis/Redis/public/docker/docker_1.png" alt="docker_1">

تمام شد! ردیس شما آماده است. میتوانید از طریق دستورات زیر به redis-cli در کامندلاین دسترسی پیدا کنید.

3. از دستور زیر برای باز کردن redis-cli استفاده کنید.

<div dir="ltr">

```
docker exec -it my-first-redis sh
redis-cli
```
</div>

4. میتوانید از دستور `ping` برای بررسی وجود اتصال مناسب استفاده کنید. در صورتی که اتصال برقرار باشد پاسخ `PONG` دریافت خواهد شد.

<img src="https://github.com/AryanAhadinia/web_workshop/blob/redis/Redis/public/docker/docker_2.png" alt="docker_2">

## پله پله تا دستور های ردیس 

برای شروع، میتوانیم از دستور زیر، برای ذخییره مقدار "fido" در کلید "server:name" استفاده کنیم.

<div dir="ltr">

```
SET server:name "fido"
```
</div>

می توانیم برای دریافت مقدار ذخیره شده در یک کلید مانند "server:name" از دستور زیر استفاده کنیم.

<div dir="ltr">

```
GET server:name
    => fido
```
</div>

اگر برای دریافت مقدار یک کلید مقداردهی نشده درخواست کنیم، nil دریافت خواهیم کرد.

<div dir="ltr">

```
GET server:blabla
    => nil
```
</div>

برای اینکه بررسی کنیم آیا یک کلید مقدار دهی شده است یا خیر، میتوانیم از دستور زیر استفاده کنیم.

<div dir="ltr">

```
EXISTS server:name
    => 1
```
```
EXISTS server:blabla
    => 0
```
</div>

میتوانیم برای حذف یک کلید مقداردهی شده، از دستور زیر استفاده کنیم.

<div dir="ltr">

```
DEL server:name
```
</div>

مشابه اکثر زبان های برنامه نویسی، دستوری برای اضافه کردن به مقدار یک کلید عددی و کم کردن از کلید عددی، به طور خاص اضافه کردن یک واحد و کم کردن یک واحد در ردیس داریم. نکته حائز اهمیت، Thread Safe بودن این دستور ها است که جلوتر توضیح خواهیم داد.

اضافه کردن یک واحد:

<div dir="ltr">

```
INCR server:name
```
</div>

اضافه کردن به میزان دلخواه:

<div dir="ltr">

```
INCRBY server:name 100
```
</div>

کم کردن یک واحد:

<div dir="ltr">

```
DECR server:name
```
</div>

کم کردن به میزان دلخواه:

<div dir="ltr">

```
DECRBY server:name 100
```
</div>

با یک مثال این را توضیح می دهیم.

<div dir="ltr">

```
SET open_connections 0
INCR open_connctions
    => 1
INCR open_connctions
    => 2
INCR open_connctions
    => 3
INCRBY open_connctions 100
    => 103
DECRBY open_connctions 23
    => 80
```
</div>

شاید تصور کنید که مزیت استفاده از این دستور ها، تنها در سادگی نوشتار است. به عنوان مثال ممکن است دو قطعه کد زیر را معادل بدانید.

<div dir="ltr">

```
INCR open_connctions
```
```
x = GET connections
x = x + 1
SET connections x
```
</div>

در حالت تک کاربره، این دو دستور درواقع معدل یک دیگر عمل می کنند.
اما در صورتی که برنامه ما multi-client باشد. ممکن است همزمانی منجر به ایجاد نتیجه نامطلوب شود.
به عنوان مثال فرض کنید که دو کلایت A و B داریم.
کلاینت A می خواهد یک واحد به connections اضافه کند و کلاینت B میخواهد یک واحد کم کند.
از آنجایی که توابع INCR و DECR همزمانی را نمی پذیرند، این کار در صورت استفاده از این توابع بدون مشکل انجام خواهد شد.
اما اگر از قطعه کد دوم استقاده کنیم. هممانی اجرای Thread ها میتواند مشکل ساز شود.

<div dir="ltr">

```
SET c 1                         // c  == 1
A executes: x1 = GET c          // x1 == 1
B executes: x2 = GET c          // x2 == 1
A executes: x1 = x1 + 1         // x1 == 2
B executes: x2 = x2 - 1         // x2 == 0
A executes: SET c x1            // c  == 2
B executes: SET c x2            // c  == 0, Confilict: expected 1 got 0
```
</div>

توجه کنید که مثال فوق تنها یک ترتیب فرضی مشکل ساز بود.
برنامه های چند رشته ای بدون هیچ ترتیب خاصی اجرا میشوند.

ممکن است بخواهیم از ردیس به عنوان یک cache مدت دار استفاده کنیم یا به هر دلیل دیگری، بخواهیم که داده ای که در ردیس ذخیره می کنیم، پس از مدتی منقضی و از حافظه حذف شود.
در این صورت می توانیم از دستور های زیر استفاده کنیم.

برای اینکه زمان انقضا برا یک داده مربوط به یک کلید استفاده کنیم می توانیم از دستور EXPIRE استفاده کنیم. مقیاس زمانی این دستور ثانیه است.

<div dir="ltr">

```
SET temp 1
EXPIRE temp 10
```
</div>

اگر بخواهیم در زمان مقدار دهی نیز میتوانیم مستقیما این کار را به این صورت انجام دهیم.

<div dir="ltr">

```
SET temp 1 EX 10
```
</div>

اگر بخواهیم میتوانیم به جای EXPIRE از PEXPIRE برای زمان دهی در مقیاس میلی ثانیه استفاده کنیم.

<div dir="ltr">

```
SET temp 1
PEXPIRE temp 10000
```
</div>

با استفاده از دستور TTL میتوانیم زمان باقی مانده به منقضی شدن یک داده را استخراج کنیم.
از دستور PTTL نیز میتوانیم برای استحراج این مقدار در مبنای میلی ثانیه استفاده کنیم.

<div dir="ltr">

```
SET temp 1 EX 10
// after 2s
TTL temp                => 8
// after 9s
TTL temp                => -2
```
```
SET permant 2
TTL temp                => -1
```
</div>

عدد منفی دو به این معنی است که این کلید تعریف نشده است.
عدد منفی یک به این معنی است که این کلید منقضی نمیشود و در حال حاضر دائمی است.

توجه کنید که برای یک کلید، می توانیم یک کلید را از طریق دستور PERSIST دائمی کنیم.

<div dir="ltr">

```
SET temp 1 EX 10
PRESIST temp
TTL temp                => -1
```
</div>

## داده ساختار ها در ردیس

در ردیس داده ساختار های متعددی وجود دارد. این داده ساختار ها و دستورات مربوط به آن را به اختصار معرفی خواهیم کرد.

</div>
